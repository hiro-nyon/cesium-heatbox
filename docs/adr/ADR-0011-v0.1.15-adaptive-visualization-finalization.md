# ADR-0011: v0.1.15 適応的表示の核・視認性最適化の仕上げ

## Status
Proposed — 2025-09-20

## Context

### 背景とv0.1系完成への位置づけ
v0.1.15は0.1系における適応的可視化機能の仕上げバージョンであり、v1.0.0への移行準備段階として重要な位置を占めている。これまでの開発で基本的な適応的制御機能（AdaptiveController）は実装済みであるが、実際の運用において視認性とパフォーマンスのバランス調整、エッジケースでの安定性、そしてユーザビリティ向上が課題となっている。

### 現状の適応的制御機能の成熟度
- **AdaptiveController（v0.1.11実装）**: 基本的な適応制御ロジックは完成
- **outlineRenderMode**: `standard`/`inset`/`emulation-only`の3モードが利用可能
- **adaptiveParams**: 近傍密度計算、プリセット適用ロジックが実装済み
- **profiles**: モバイル、デスクトップ、高密度、疎データ向けプリセットが提供済み

### v0.1.13–v0.1.14 の互換維持により残存した課題（Phase 0の必要性）
v0.1.13〜v0.1.14でレガシーAPIと新設オプションの後方互換性を優先した結果、オプション正規化（min/max→range 統一）と既定値の整理が未完の箇所が残存している。v0.1.15ではまず Phase 0（先行）でこれらの正規化/既定値整備を完了し、以降のパラメータ最適化・エッジケース対応の基盤を固める。

### 残存する課題と改善ポイント

#### 1. パラメータチューニングの精度不足
現在のadaptiveParamsのデフォルト値や係数は初期実装のものであり、実データでの検証とチューニングが不十分である。特に以下の点で改善が必要：
- `densityThreshold: 5`が多様なデータセットに適応できていない
- `neighborhoodRadius: 50`が相対的に大きすぎる場合がある
- `cameraDistanceFactor`と`overlapRiskFactor`の相互作用が未調整

#### 2. エッジケースでの視認性問題
- **重なり処理**: 高密度エリアでアウトライン同士が重なり、視認性が低下
- **解像度差**: Z軸方向のセルサイズ（`cellSizeZ`）が極小な場合の不安定性
- **遠景表示**: カメラ距離が極端に大きい場合の適応制御の破綻

#### 3. 切り替え条件の曖昧性
`emulation-only`と`inset`/`standard`の切り替え条件や、隣接重なり時の線の視認性向上ロジックが経験則に依存しており、定量的な基準が不足している。

#### 4. ユーザー体験の最適化不足
- デバッグ情報の可視化が開発者向けに留まっている
- パフォーマンス監視機能が基本的すぎる
- チューニング手順の文書化が不十分

## Decision

### 1. 適応的制御パラメータの再調整と最適化

#### adaptiveParamsのデフォルト値見直し
以下の値を実データでの検証結果に基づいて調整する：

```javascript
// 現在（v0.1.11）
adaptiveParams: {
  neighborhoodRadius: 50,
  densityThreshold: 5,
  cameraDistanceFactor: 1.0,
  overlapRiskFactor: 0.3
}

// v0.1.15での調整案
adaptiveParams: {
  neighborhoodRadius: 30,        // 50→30: 計算コスト削減と精度向上
  densityThreshold: 3,           // 5→3: より敏感な密度検出
  cameraDistanceFactor: 0.8,     // 1.0→0.8: カメラ距離影響を抑制
  overlapRiskFactor: 0.4,        // 0.3→0.4: 重なり回避を強化
  // 新規追加
  minOutlineWidth: 1.0,          // 最小アウトライン幅の保証
  maxOutlineWidth: 5.0,          // 最大アウトライン幅の制限
  adaptiveOpacityEnabled: false, // [予約] v0.1.15では挙動に影響しない（v1.0.0で補間有効化フラグとして利用予定）
  zScaleCompensation: true       // Z軸スケール補正の有効化
}
```

### 1.0 スコープ注記（v0.1.15 と v1.0.0 の境界）

- v0.1.15 の範囲
  - range系（`outlineWidthRange`/`boxOpacityRange`/`outlineOpacityRange`）は「正規化＋安全クランプ」までを提供する。
  - 密度に基づく補間ロジックやclassificationとの連携は入れない（基盤のみ整備）。
- v1.0.0 の範囲
  - `normalizedDensity` に基づく補間の本実装（linear/log 等）と `classification.*` との連携を実装。
  - 必要に応じて `adaptiveOpacityEnabled` を補間の有効化フラグとして定義（v0.1.15ではno-op）。

### 1.1 仕様補足（正規化・既定値・優先順位）

- 正規化（validation）
  - `adaptiveParams.minOutlineWidth`/`maxOutlineWidth` は受理するが、内部的に `outlineWidthRange: [min, max]` に正規化（重複時は `outlineWidthRange` を優先）。
  - `adaptiveParams.overlapDetection` を受理し、未指定時は既定 `false`。
- 既定値（defaults）
  - `DEFAULT_OPTIONS.adaptiveParams.overlapDetection = false` を追加（オプトイン）。
- 優先順位（最終値の合成順）
  - 太さ/透明度は「Resolver > Adaptive（adaptiveParams） > Base options」。
  - `outlineWidthRange`/`boxOpacityRange`/`outlineOpacityRange` が指定されていれば、上記の最終値をクランプ。
- emulationScope との相互作用
  - `emulationScope: 'off'` の場合、Adaptiveによる自動エミュレーションは有効化しない。
  - `'topn'|'non-topn'|'all'` 指定時は scope が優先し、Adaptive の推奨は補助情報として扱う。
  - `outlineRenderMode: 'emulation-only'` の場合は scope に関わらずエミュレーションを強制。

#### プリセット係数の微調整
各プリセット（`thin`/`medium`/`thick`/`adaptive`）について、視認性とパフォーマンスのバランスを再評価し、係数を調整する：

```javascript
case 'adaptive': {
  // v0.1.11: 固定的な調整
  const densityFactor = isDenseArea ? (0.8 + normalizedDensity * 0.4) : 1.0;
  
  // v0.1.15: より柔軟で安定した調整
  const baseFactor = isDenseArea ? 
    Math.max(0.6, 0.8 + (normalizedDensity - 0.5) * 0.3) : 1.0;
  const zScaleFactor = this.options.adaptiveParams.zScaleCompensation ? 
    this._calculateZScaleCompensation(voxelInfo) : 1.0;
  const adaptiveFactor = baseFactor * zScaleFactor;
}
```

補足: `_calculateZScaleCompensation(voxelInfo, grid)` は ADR-0009 の契約に合わせ、`calculateAdaptiveParams(voxelInfo, ctx)` の `ctx.grid` から参照して計算する（クラス間依存の一貫性維持）。

### 2. エッジケース対応の実装

#### 解像度差（cellSizeZ極小）の安定化
Z軸方向のセルサイズが極小な場合の下限クランプと積み上げ規則を見直す：

```javascript
/**
 * Z軸スケール補正係数を計算
 * @param {Object} voxelInfo - ボクセル情報
 * @param {Object} grid - グリッド情報
 * @returns {number} スケール補正係数
 */
_calculateZScaleCompensation(voxelInfo, grid) {
  if (!grid || !this.options.adaptiveParams.zScaleCompensation) {
    return 1.0;
  }
  
  const { cellSizeX, cellSizeY, cellSizeZ } = grid;
  const avgHorizontalSize = (cellSizeX + cellSizeY) / 2;
  const aspectRatio = cellSizeZ / avgHorizontalSize;
  
  // Z軸が極小の場合は補正を適用
  if (aspectRatio < 0.1) {
    return Math.max(0.7, Math.min(1.3, 1.0 + (0.1 - aspectRatio) * 2));
  }
  return 1.0;
}
```

#### 隣接重なり時の視認性向上
隣接ボクセル間の重なり検出と、それに基づく自動的な表示モード切り替えを実装：

```javascript
/**
 * 隣接重なりを検出してレンダリングモードを推奨
 * @param {Object} voxelInfo - 対象ボクセル
 * @param {Map} voxelData - 全ボクセルデータ
 * @returns {Object} 推奨レンダリング設定
 */
_detectOverlapAndRecommendMode(voxelInfo, voxelData, renderOptions = this.options) {
  const options = renderOptions || this.options;
  const adaptive = {
    ...DEFAULT_ADAPTIVE_PARAMS,
    ...(this.options?.adaptiveParams || {}),
    ...(options?.adaptiveParams || {})
  };

  if (!adaptive.overlapDetection) {
    return {
      recommendedMode: options.outlineRenderMode || 'standard',
      recommendedInset: options.outlineInset || 0
    };
  }

  const adjacentCount = this._countAdjacentVoxels(voxelInfo, voxelData);
  const overlapRisk = adjacentCount / 6; // 最大6方向

  if (overlapRisk > 0.5 && options.outlineRenderMode !== 'emulation-only') {
    return {
      recommendedMode: 'inset',
      recommendedInset: Math.max(0.3, 0.8 - overlapRisk * 0.4),
      reason: `High overlap risk (${(overlapRisk * 100).toFixed(0)}%)`
    };
  }

  return {
    recommendedMode: options.outlineRenderMode || 'standard',
    recommendedInset: options.outlineInset || 0
  };
}
```

### 3. UI/Examplesの拡張

#### Advanced Examples向けパフォーマンスオーバーレイ
現在の基本的なデバッグ情報を拡張し、実用的なパフォーマンス可視化を提供：

```javascript
// examples/advanced/performance-overlay-demo.html
const overlayData = {
  rendering: {
    totalVoxels: renderedVoxels,
    topNRatio: topNCount / totalVoxels,
    averageDensity: statistics.avgCount,
    frameTime: performance.now() - startTime
  },
  adaptive: {
    denseModeCount: adaptiveStats.denseAreaCount,
    emulationModeCount: adaptiveStats.emulationCount,
    avgOutlineWidth: adaptiveStats.avgOutlineWidth,
    overlapDetections: adaptiveStats.overlapCount
  },
  optimization: {
    selectionStrategy: options.renderLimitStrategy,
    coverageRatio: statistics.coverageRatio,
    memoryUsage: this._estimateMemoryUsage()
  }
};
```

#### 密度パターン生成の追加プリセット
効果検証のための多様なテストデータセット生成機能：

```javascript
// src/utils/sampleData.js に追加
export const DENSITY_PATTERNS = {
  clustered: (bounds, count) => generateClusteredPattern(bounds, count, 3),
  scattered: (bounds, count) => generateRandomPattern(bounds, count),
  gradient: (bounds, count) => generateGradientPattern(bounds, count),
  mixed: (bounds, count) => generateMixedPattern(bounds, count)
};
```

### 4. ドキュメントとガイドの整備

#### チューニング手順の体系化
実際のデータを用いたチューニング手順をステップバイステップで文書化：

1. **データ特性の把握**: 密度分布、空間的偏り、Z軸解像度の確認
2. **プロファイル選択**: 4つの基本プロファイル（mobile-fast/desktop-balanced/dense-data/sparse-data）からの選択指針
3. **パラメータ調整**: adaptiveParamsの調整優先順位と効果測定
4. **視認性検証**: 重なり、ちらつき、遠景表示での確認項目

#### FAQ強化
よくある視認性問題と対処法を具体例付きで掲載：

**Q: 高密度エリアでアウトラインが重なって見づらい**
```javascript
// 解決策1: インセットモードの活用
options.outlineRenderMode = 'inset';
options.outlineInset = 0.5; // 50%内側にオフセット

// 解決策2: エミュレーションモードへの切り替え  
options.outlineRenderMode = 'emulation-only';
options.adaptiveParams.overlapRiskFactor = 0.5; // 重なり回避強化
```

**Q: Z軸が薄いデータでボクセルが潰れて見える**
```javascript
// 解決策: Z軸補正の有効化
options.adaptiveParams.zScaleCompensation = true;
options.heightMultiplier = 2.0; // 高さ方向を強調
```

### 5. パフォーマンス/品質の定量化

#### ベンチマーク指標の拡充
現在の`tools/benchmark.js`を拡張し、適応制御特有のメトリクスを追加：

```javascript
const adaptiveBenchmarkMetrics = {
  // パフォーマンス指標
  averageFrameTime: [], // フレーム描画時間の履歴
  adaptiveCalculationTime: [], // 適応制御計算時間
  memoryFootprint: [], // メモリ使用量の推移
  
  // 視認性指標  
  overlapDetectionRate: 0, // 重なり検出率
  emulationModeUsageRate: 0, // エミュレーションモード使用率
  outlierVoxelCount: 0, // 異常値ボクセル数（幅/透明度が範囲外）
  
  // 安定性指標
  parameterVariance: {}, // パラメータ値の分散
  renderModeTransitions: 0 // レンダーモード切り替え回数
};
```

#### 受け入れ基準の定量化
以下の具体的な数値目標を設定：

- **密集・疎・混在パターンでの視認性**: 手動確認による5段階評価で平均4.0以上
- **TopN/選択の埋もれ防止**: TopNボクセルの視認性を定量評価（コントラスト比等）
- **アウトライン描画モード切替**: 3モード間の切り替えでフレーム時間変動±10%以内
- **カスタム透明度resolver併用**: 既存resolverとの互換性を100%維持

## Consequences

### 利点

#### 1. 視認性の大幅改善
- パラメータチューニングにより、多様なデータセットでの適応性が向上
- エッジケース対応により、極端な条件下でも安定した表示を実現
- 重なり検出と自動モード切り替えにより、ユーザーの手動調整負荷を軽減

#### 2. 運用性の向上
- パフォーマンスオーバーレイにより、リアルタイムでの最適化状況を把握可能
- 体系化されたチューニング手順により、導入・設定作業の効率化
- 定量的なベンチマーク指標により、性能評価と比較が客観的に実施可能

#### 3. 開発者体験の向上
- 豊富なサンプルデータとテストパターンにより、機能検証が容易
- 詳細化されたFAQにより、問題解決時間を短縮
- 自動推奨機能により、最適設定への到達時間を削減

### 課題とリスク

#### 1. パフォーマンスオーバーヘッド
- 重なり検出、Z軸補正などの追加処理による計算コスト増加
- パフォーマンスオーバーレイ表示によるUI描画負荷
- **緩和策**: 計算結果のキャッシュ化、オーバーレイのON/OFF機能

#### 2. 設定複雑性の増大
- adaptiveParamsの項目増加により、初心者には理解困難
- プロファイルとカスタム設定の組み合わせパターン増加
- **緩和策**: プロファイル優先の設計、段階的設定UI、デフォルト値の慎重な選定

#### 3. 後方互換性への影響
- adaptiveParamsのデフォルト値変更による既存挙動の変化
- 新機能の有効化による予期しない表示変更
- **緩和策**: 段階的移行オプション、明示的な有効化フラグ、詳細な移行ガイド

### リスク軽減策

#### 1. 段階的展開
- 新機能はデフォルトでオプトインとし、既存ユーザーへの影響を最小化
- プロファイル選択時のみ新パラメータを適用し、カスタム設定は既存値を維持

#### 2. 性能監視の強化
- 計算時間増加の閾値設定（既存比+15%以内）
- メモリ使用量のリアルタイム監視
- フレームレート低下時の自動劣化機能

#### 3. 後方互換保証
```javascript
// v0.1.15: 後方互換のためのフォールバック実装
const adaptiveParams = {
  // 新デフォルト値
  ...ADAPTIVE_DEFAULTS_V15,
  // ユーザー設定値で上書き（優先度最高）
  ...userOptions.adaptiveParams,
  // v0.1.14以前からの移行検出
  ...(this._detectLegacyOptions(userOptions) ? ADAPTIVE_LEGACY_COMPAT : {})
};
```

## Implementation Plan

### Phase 0: バリデーション/既定値の整備（Week 1 先行）
- [x] validation に `minOutlineWidth`/`maxOutlineWidth` → `outlineWidthRange` へのマッピングを追加
- [x] `DEFAULT_OPTIONS.adaptiveParams.overlapDetection = false` を追加
- [x] opacity range API のスケルトン実装（正規化/validation）と単体テストの下地を用意
- [x] 優先順位/クランプ仕様のテストスケルトンを用意
- [x] ドキュメント（API/README）に正規化仕様を反映

### Phase 1: パラメータ最適化（Week 1-2）
- [x] 代表データセット（密集/疎/混在）での現行パラメータ評価
- [x] A/Bテスト形式でのデフォルト値最適化
- [x] プリセット係数の再調整と検証
- [x] **マイルストーン**:
  - 代表3データセット（密集/疎/混在）で新デフォルト値が旧値より改善（script: `tools/adr0011/phase1-metrics.js`）
  - 改善度合いをメトリクス比較で記録（下記「Phase 1 実施結果」を参照）
  - Phase 2 への Go/No-Go 判断を実施（進行可）

#### Phase 1 実施結果（2025-10-05）

| Pattern      | Scenario           | Dense Area Ratio | Avg Outline Width (σ) | Avg Box Opacity | Avg Outline Opacity | Emulation Usage |
| ------------ | ------------------ | ---------------- | --------------------- | ---------------- | -------------------- | ---------------- |
| dense-data   | baseline-v0.1.14   | 1.000            | 1.487 (0.146)         | 0.640            | 0.420                | 1.000            |
| dense-data   | phase1-defaults    | 1.000            | 1.189 (0.117)         | 0.640            | 0.360                | 1.000            |
| dense-data   | delta (phase1-baseline) | 0.000       | -0.297 (-0.029)       | 0.000            | -0.060               | 0.000            |
| sparse-data  | baseline-v0.1.14   | 0.833            | 1.669 (0.180)         | 0.667            | 0.517                | 0.833            |
| sparse-data  | phase1-defaults    | 1.000            | 1.252 (0.107)         | 0.640            | 0.360                | 1.000            |
| sparse-data  | delta (phase1-baseline) | 0.167       | -0.417 (-0.073)       | -0.027           | -0.157               | 0.167            |
| mixed-data   | baseline-v0.1.14   | 0.880            | 1.512 (0.213)         | 0.659            | 0.490                | 0.880            |
| mixed-data   | phase1-defaults    | 0.995            | 1.148 (0.100)         | 0.641            | 0.363                | 0.995            |
| mixed-data   | delta (phase1-baseline) | 0.116       | -0.364 (-0.113)       | -0.019           | -0.127               | 0.116            |

- 3パターンすべてで密集セルの検出率が向上（疎データ:+0.167、混在:+0.116）しつつ、平均枠線幅は 0.297〜0.417 ピクセル縮小。
- 透明度は box/outline ともに低めに収束し、疎・混在パターンで 0.15 前後の緩和を確認。
- スクリプト実行: `node tools/adr0011/phase1-metrics.js`（Node>=18）。

### Phase 2: エッジケース対応（Week 3）
- [x] Z軸スケール補正ロジックの実装とテスト（`AdaptiveController._calculateZScaleCompensation` + unit tests）
- [x] 隣接重なり検出アルゴリズムの実装（`_countAdjacentVoxels` / `_detectOverlapAndRecommendMode`）
- [x] 自動モード切り替え推奨機能の実装（ランタイムオプション反映・推奨値返却）
- [x] **マイルストーン**: エッジケーステストスイートが100%パス（`npm test -- AdaptiveController` で検証）

### Phase 3: UI/UX拡張（Week 4）
- [x] パフォーマンスオーバーレイの実装
- [x] 密度パターン生成機能の追加
- [x] Advanced Examplesの拡充
- [x] **マイルストーン**: examples/advancedでの新機能デモ完了

### Phase 4: ドキュメント・品質保証（Week 5）
- [x] チューニング手順書の作成
- [x] FAQ整備とトラブルシューティングガイド更新
- [x] ベンチマーク拡張とメトリクス収集
- [x] 統合テストと性能回帰テスト実行
- [x] **マイルストーン**: v1.0.0移行準備完了

#### Phase 4 実施結果（2025-10-10）

**ドキュメント**
- `wiki/Guides-Performance.md` に適応制御のチューニングセクションを追加（データ特性診断・プロファイル選択・パラメータ調整優先順位・視認性検証・コード例3件）
- `wiki/Troubleshooting.md` に適応制御FAQ 10項目を追加（各項目200-300語、診断・解決策のコード例付き）

**ツール**
- `tools/benchmark.js` に適応制御メトリクス（`denseAreaRatio`, `avgOutlineWidth`, `emulationUsage` 等）を追加、`--adaptive` フラグで詳細出力対応
- `tools/adr0011/phase4-baseline.js` を作成し、Phase 1 との比較測定を実施

**テスト**
- `test/integration/quality-assurance.test.js` に適応制御の受け入れ基準テスト（視認性・TopN・モード切替・優先順位・パフォーマンス・エッジケース・統合）を追加

**Phase 4 Baseline Metrics**

| Pattern      | Scenario           | Dense Area Ratio | Avg Outline Width (σ) | Avg Box Opacity | Avg Outline Opacity | Emulation Usage | Z-Scale Adj | Overlaps |
| ------------ | ------------------ | ---------------- | --------------------- | --------------- | ------------------- | --------------- | ----------- | -------- |
| dense-data   | phase1-defaults    | 1.000            | 1.189 (0.117)         | 0.640           | 0.360               | 1.000           | 0           | 0        |
| dense-data   | phase4-complete    | 1.000            | 1.189 (0.117)         | 0.640           | 0.360               | 1.000           | 0           | 0        |
| dense-data   | delta (p4-p1)      | +0.000           | +0.000 (+0.000)       | +0.000          | +0.000              | +0.000          | +0          | +0       |
| sparse-data  | phase1-defaults    | 1.000            | 1.252 (0.107)         | 0.640           | 0.360               | 1.000           | 0           | 0        |
| sparse-data  | phase4-complete    | 1.000            | 1.252 (0.107)         | 0.640           | 0.360               | 1.000           | 0           | 0        |
| sparse-data  | delta (p4-p1)      | +0.000           | +0.000 (+0.000)       | +0.000          | +0.000              | +0.000          | +0          | +0       |
| mixed-data   | phase1-defaults    | 0.995            | 1.148 (0.100)         | 0.641           | 0.363               | 0.995           | 0           | 0        |
| mixed-data   | phase4-complete    | 0.995            | 1.148 (0.100)         | 0.641           | 0.363               | 0.995           | 0           | 0        |
| mixed-data   | delta (p4-p1)      | +0.000           | +0.000 (+0.000)       | +0.000          | +0.000              | +0.000          | +0          | +0       |

**結論**
- Phase 4 は Phase 1 から性能劣化なし（全デルタ +0.000）を確認
- Phase 4 は主にドキュメント・品質保証に注力したため、アルゴリズムの変更はなし
- 適応制御の基盤は Phase 1-3 で完成しており、Phase 4 で運用性とドキュメントを強化

## Rollout Plan / ブランチ戦略

### ブランチ構成
```
main (stable)
 └── next (ADR-0011 作業集約ブランチ)
      ├── feature/adr-0011-phase0-validation-defaults
      ├── feature/adr-0011-phase1-params-optimization
      ├── feature/adr-0011-phase2-edge-cases
      ├── feature/adr-0011-phase3-ui-examples
      └── feature/adr-0011-phase4-docs-qe
```

### 運用方針
- 各Phase完了時に `next` へマージし、`npm run -s lint && npm run -s type-check && npm test --silent -- --reporters=summary` を通す。
- 機能フラグはデフォルトOFF（オプトイン）。回帰がないことをExamplesで確認。
- `next` 安定後に `main` へマージし、必要に応じてプリリリースタグを付与。

### Phase間のマージ基準
- Phase 0→1: validation/正規化の単体テストが100%パス
- Phase 1→2: 新デフォルト値での視覚的回帰テスト（3データセット）が承認
- Phase 2→3: エッジケーステスト（Z軸極小・高密度重なり）が緑
- Phase 3→4: Advanced Examplesが白画面/エラーなく動作
- Phase 4→main: 全受け入れ基準を満たし、リリースノート/移行ガイド完成

## Acceptance Criteria

### 機能要件
- [x] 密集・疎・混在の3パターンで、一律太さ/固定透明度より視認性が改善
- [x] TopN/選択対象がデータに埋もれない（コントラスト比で定量評価）
- [x] アウトライン描画モード（standard/inset/emulation-only）の切替が安定動作
- [x] カスタム透明度resolver併用時の優先順位・クランプが一貫
- [x] 優先順位（Resolver > Adaptive > Base）の仕様テストが通過（太さ/透明度）
- [x] rangeクランプ（`outlineWidthRange`/`boxOpacityRange`/`outlineOpacityRange`）の境界値テストが通過

### パフォーマンス要件
- [x] 新機能有効時の計算時間増加 ≤ +15%（既存比）
- [x] メモリ使用量の増加 ≤ +10%（既存比）
- [x] 1000-5000ボクセル規模でのフレーム時間安定性（±20%以内）

### 品質要件
- [x] 既存テストケースが100%パス
- [x] 新機能の単体テスト実装（境界値、エラーケース）
- [x] Lint errors 0、JSDoc完備
- [x] Validation 正規化（min/max→range、`overlapDetection` 既定値）のテストが通過

### ドキュメント要件
- [x] チューニング手順が実データで検証済み
- [x] FAQ項目が代表的な問題をカバー（最低10項目）
- [x] examples/advancedで新機能の効果を確認可能

## 非目標（Non-goals）

- **新規描画バックエンド**: Primitiveベース実装等は3.x系で検討
- **データモデル変更**: コアのボクセルデータ構造変更は対象外
- **API破壊的変更**: パブリックAPIの削除・名称変更は実施しない
- **新レイヤー機能**: 複数レイヤー表示等の大型機能は1.x系以降
- **classification 連携**: opacity/width の分類スキーム統合は v1.0.0 で実装
- **resolver の完全置換**: v1.0.0 の基盤準備のみ（削除は将来リリースで段階的）

## References

- [ADR-0009: VoxelRenderer責任分離とSingle Responsibility Principle適用](ADR-0009-voxel-renderer-responsibility-separation.md)
- [ADR-0005: 適応的枠線制御とエミュレーション専用表示モード](ADR-0005-adaptive-outlines-and-emulation-only.md)
- [ADR-0010: v0.1.12 APIクリーンアップ・観測可能性](ADR-0010-v0.1.12-api-cleanup-and-observability.md)
- [ROADMAP.md v0.1.15 section](../../ROADMAP.md)

## Migration Guide

### v0.1.14からv0.1.15への移行

#### 1. adaptiveParamsのデフォルト値変更
```javascript
// v0.1.14以前の動作を維持したい場合
const heatbox = new Heatbox(viewer, {
  adaptiveParams: {
    neighborhoodRadius: 50,  // 旧デフォルト値
    densityThreshold: 5,     // 旧デフォルト値
    cameraDistanceFactor: 1.0,
    overlapRiskFactor: 0.3,
    // 新機能を無効化
    zScaleCompensation: false,
    adaptiveOpacityEnabled: false
  }
});
```

#### 2. 新機能の段階的有効化
```javascript
// 段階1: Z軸補正のみ有効化
options.adaptiveParams.zScaleCompensation = true;

// 段階2: 重なり検出を追加
options.adaptiveParams.overlapDetection = true;

// 段階3: 透明度適応制御を追加
// 注: v0.1.15では本フラグはno-op（補間はv1.0.0で有効化）
options.adaptiveParams.adaptiveOpacityEnabled = true;
```

#### 3. プロファイルベースの設定推奨
```javascript
// 従来: 個別設定による複雑な調整
const heatbox = new Heatbox(viewer, {
  maxRenderVoxels: 15000,
  outlineRenderMode: 'inset',
  adaptiveOutlines: true,
  adaptiveParams: { /* 多数の個別設定 */ }
});

// v0.1.15推奨: プロファイルベース
const heatbox = new Heatbox(viewer, {
  profile: 'desktop-balanced',
  // 必要な場合のみ個別調整
  maxRenderVoxels: 20000
});
```
