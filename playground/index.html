<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cesium Heatbox Playground</title>
  <!-- Favicon ã‚’è¿½åŠ ã—ã¦ã‚¨ãƒ©ãƒ¼ã‚’é˜²ã -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŒ</text></svg>">
  <!-- CesiumJS CDN - ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.120 -->
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.120/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.120/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  
  <!-- Cesium settings (no Ion token; CartoDB Light imagery set in app.js) -->
  <script>
    window.CESIUM_BASE_URL = 'https://cesium.com/downloads/cesiumjs/releases/1.120/Build/Cesium/';
    if (typeof Cesium !== 'undefined' && Cesium.Ion) {
      Cesium.Ion.defaultAccessToken = null; // æ˜ç¤ºçš„ã«Ionã‚’ç„¡åŠ¹åŒ–
    }
  </script>
  <style>
    html, body, #cesiumContainer {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: 'Noto Sans JP', sans-serif;
      background-color: #111;
    }
    
    #cesiumContainer {
      background-color: #0e1b22 !important;
    }
    
    #toolbar {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.7);
      padding: 10px;
      border-radius: 5px;
      color: white;
      z-index: 1000;
      max-width: 360px;
      max-height: calc(100% - 20px);
      overflow-y: auto;
    }
    
    #toolbar button {
      margin: 5px;
      padding: 8px 12px;
      border: none;
      border-radius: 3px;
      background: #4CAF50;
      color: white;
      cursor: pointer;
      font-size: 12px;
    }
    
    #toolbar button:hover {
      background: #45a049;
    }
    
    #toolbar button:disabled {
      background: #666;
      cursor: not-allowed;
    }
    
    #info {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.7);
      padding: 10px;
      border-radius: 5px;
      color: white;
      z-index: 1000;
      max-width: 250px;
      font-size: 12px;
    }
    
    #fileInput {
      margin: 10px 0;
    }
    
    /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³å…±é€šã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆdiv/.section ã¨ details.section ã‚’ä¸¡å¯¾å¿œï¼‰ */
    .section {
      margin: 10px 0;
      padding: 10px;
      border: 1px solid #444;
      border-radius: 3px;
      background: rgba(0,0,0,0.25);
    }
    .section h3, .section > summary {
      margin: 0 0 10px 0;
      font-size: 14px;
    }
    details.section > summary {
      cursor: pointer;
      list-style: none;
      outline: none;
    }
    details.section > summary::-webkit-details-marker {
      display: none;
    }
    details.section > summary::before {
      content: 'â–¸';
      display: inline-block;
      margin-right: 6px;
      transform: translateY(-1px);
      opacity: 0.9;
    }
    details.section[open] > summary::before {
      content: 'â–¾';
    }
    .section-content {
      margin-top: 8px;
    }
  
    .controls {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .control-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .control-group label {
      flex: 1;
      font-size: 11px;
    }
    
    .control-group input, .control-group select {
      flex: 1;
      padding: 2px;
      border: 1px solid #666;
      border-radius: 2px;
      background: #333;
      color: white;
    }
    
    #loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 20px;
      border-radius: 5px;
      z-index: 2000;
      display: none;
    }
  </style>
</head>
<body>
  <div id="cesiumContainer"></div>
  
  <div id="toolbar">
    <div class="section">
      <h3 id="i18n-title">ğŸ›ï¸ Cesium Heatbox Playground</h3>
      <p style="font-size: 11px; margin: 5px 0;">v0.1.7 å¯¾å¿œãƒ»UIæ•´ç†ç‰ˆ</p>
      <div class="control-group">
        <label id="i18n-lang-label" for="langSelect">è¨€èª</label>
        <select id="langSelect">
          <option value="ja">æ—¥æœ¬èª</option>
          <option value="en">English</option>
        </select>
      </div>
    </div>
    
    <details class="section" open>
      <summary id="i18n-sum-data">ğŸ“ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿</summary>
      <div class="section-content">
        <input type="file" id="fileInput" accept=".json,.geojson,.czml" />
        <button id="loadSampleData">ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿</button>
        <button id="generateTestData">ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ</button>
      </div>
    </details>
    
    <details class="section" open>
      <summary id="i18n-sum-display">ğŸ”§ è¡¨ç¤ºè¨­å®š</summary>
      <div class="controls section-content">
        <div class="control-group">
          <label>èƒŒæ™¯åœ°å›³:</label>
          <select id="baseMap">
            <option value="carto-light" selected>CartoDB Light (Positron)</option>
            <option value="carto-dark">CartoDB Dark Matter</option>
            <option value="osm-standard">OpenStreetMap Standard</option>
            <option value="osm-humanitarian">OSM Humanitarian</option>
          </select>
        </div>
        <div class="control-group">
          <label>
            <input type="checkbox" id="autoVoxelSize" />
            è‡ªå‹•ã‚µã‚¤ã‚ºæ±ºå®šï¼ˆv0.1.4æ–°æ©Ÿèƒ½ï¼‰
          </label>
        </div>
        <div class="control-group" id="manualSizeGroup">
          <label>ã‚°ãƒªãƒƒãƒ‰ã‚µã‚¤ã‚ºï¼ˆæ‰‹å‹•ï¼‰:</label>
          <input type="range" id="gridSize" min="10" max="100" value="20" />
          <span id="gridSizeValue">20</span>
        </div>
        <div class="control-group">
          <label>
            <input type="checkbox" id="heightBased" />
            é«˜ã•ãƒ™ãƒ¼ã‚¹è¡¨ç¾
          </label>
        </div>
        <div class="control-group">
          <label>
            <input type="checkbox" id="showEmptyVoxels" />
            ç©ºã®ãƒœã‚¯ã‚»ãƒ«ã‚’è¡¨ç¤º
          </label>
        </div>
        <div class="control-group" id="emptyOpacityGroup" style="opacity: 0.5; pointer-events: none;">
          <label>ç©ºãƒœã‚¯ã‚»ãƒ«é€æ˜åº¦:</label>
          <input type="range" id="emptyOpacity" min="0" max="1" step="0.05" value="0.1" disabled />
          <span id="emptyOpacityValue">0.1</span>
        </div>
        <div class="control-group">
          <label>
            <input type="checkbox" id="wireframeOnly" />
            æ ç·šã®ã¿è¡¨ç¤º
          </label>
        </div>
      </div>
    </details>

    <details class="section">
      <summary id="i18n-sum-color">ğŸ¨ è‰²è¨­å®š</summary>
      <div class="controls section-content">
        <div class="control-group">
          <label>ã‚«ãƒ©ãƒ¼ãƒãƒƒãƒ—:</label>
          <select id="colorMap">
            <option value="custom">ã‚«ã‚¹ã‚¿ãƒ ï¼ˆå¾“æ¥ï¼‰</option>
            <option value="viridis" selected>Viridisï¼ˆç§‘å­¦çš„ï¼‰</option>
            <option value="inferno">Infernoï¼ˆç§‘å­¦çš„ï¼‰</option>
          </select>
        </div>
        <div class="control-group" id="customColorGroup">
          <label>ã‚«ã‚¹ã‚¿ãƒ è‰²:</label>
          <select id="customColorTheme">
            <option value="heat">ãƒ’ãƒ¼ãƒˆï¼ˆé’â†’èµ¤ï¼‰</option>
            <option value="cool">ã‚¯ãƒ¼ãƒ«ï¼ˆé’â†’ãƒã‚¼ãƒ³ã‚¿ï¼‰</option>
            <option value="rainbow">ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼</option>
          </select>
        </div>
        <div class="control-group">
          <label>
            <input type="checkbox" id="diverging" />
            äºŒæ¥µæ€§ãƒ‡ãƒ¼ã‚¿ï¼ˆblue-white-redï¼‰
          </label>
        </div>
        <div class="control-group" id="divergingPivotGroup" style="opacity: 0.5; pointer-events: none;">
          <label>äºŒæ¥µæ€§ä¸­å¿ƒå€¤:</label>
          <input type="number" id="divergingPivot" value="0" step="0.1" disabled />
        </div>
      </div>
    </details>

    <details class="section">
      <summary id="i18n-sum-outline">âœï¸ æ ç·šãƒ»è¦‹ãŸç›®</summary>
      <div class="controls section-content">
        <div class="control-group">
          <label>æç”»ãƒ¢ãƒ¼ãƒ‰:</label>
          <select id="outlineRenderMode">
            <option value="standard" selected>æ¨™æº–</option>
            <option value="inset">ã‚¤ãƒ³ã‚»ãƒƒãƒˆä¸»ä½“</option>
            <option value="emulation-only">ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ã¿</option>
          </select>
        </div>
        <!-- v0.1.6.1: ã‚¤ãƒ³ã‚»ãƒƒãƒˆæ ç·šï¼ˆADR-0004ï¼‰ -->
        <div class="control-group">
          <label>ã‚¤ãƒ³ã‚»ãƒƒãƒˆæ ç·š (m):</label>
          <input type="range" id="outlineInset" min="0" max="20" step="0.5" value="0" />
          <span id="outlineInsetValue">0.0</span>
        </div>
        <div class="control-group">
          <label>ã‚¤ãƒ³ã‚»ãƒƒãƒˆé©ç”¨ç¯„å›²:</label>
          <select id="outlineInsetMode">
            <option value="off">OFFï¼ˆç„¡åŠ¹ï¼‰</option>
            <option value="topn">TopN ã®ã¿</option>
            <option value="all" selected>å…¨ä½“</option>
          </select>
        </div>
        <div class="control-group">
          <label>
            <input type="checkbox" id="enableThickFrames" />
            åšã„æ ç·šè¡¨ç¤ºï¼ˆãƒ•ãƒ¬ãƒ¼ãƒ åŸ‹ã‚è¾¼ã¿ï¼‰
          </label>
        </div>
        <!-- v0.1.6: æ ç·šé‡ãªã‚Šå¯¾ç­–ï¼ˆãƒœã‚¯ã‚»ãƒ«é–“ã‚®ãƒ£ãƒƒãƒ—ï¼‰ -->
        <div class="control-group">
          <label>ãƒœã‚¯ã‚»ãƒ«é–“ã‚®ãƒ£ãƒƒãƒ— (m):</label>
          <input type="range" id="voxelGap" min="0" max="20" step="0.5" value="0" />
          <span id="voxelGapValue">0.0</span>
        </div>
        <!-- v0.1.6: æ ç·šé€æ˜åº¦åˆ¶å¾¡ -->
        <div class="control-group">
          <label>æ ç·šé€æ˜åº¦:</label>
          <input type="range" id="outlineOpacity" min="0" max="1" step="0.1" value="1" />
          <span id="outlineOpacityValue">1.0</span>
        </div>
        <!-- v0.1.6: æ ç·šå¤ªã•ãƒ¢ãƒ¼ãƒ‰ -->
        <div class="control-group">
          <label>æ ç·šå¤ªã•ãƒ¢ãƒ¼ãƒ‰:</label>
          <select id="outlineMode">
            <option value="adaptive" selected>è‡ªå‹•ï¼ˆå¯†åº¦ã«å¿œã˜ã¦èª¿æ•´ï¼‰</option>
            <option value="manual">æ‰‹å‹•ï¼ˆå›ºå®šå¤ªã•ï¼‰</option>
          </select>
        </div>
        <div class="control-group" id="manualOutlineWidthGroup" style="opacity: 0.5; pointer-events: none;">
          <label>æ ç·šå¤ªã• (px):</label>
          <input type="range" id="outlineWidth" min="0" max="8" step="1" value="2" disabled />
          <span id="outlineWidthValue">2</span>
        </div>
        <div class="control-group">
          <label>å¤ªç·šã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³:</label>
          <select id="outlineEmulationMode">
            <option value="off">ç„¡åŠ¹</option>
            <option value="topn">TopNã®ã¿</option>
            <option value="non-topn">TopNä»¥å¤–ã®ã¿</option>
            <option value="all">ã™ã¹ã¦å¤ªç·šï¼ˆè‡ªå‹•ã‚¤ãƒ³ã‚»ãƒƒãƒˆé©ç”¨ï¼‰</option>
          </select>
        </div>
      </div>
    </details>

    <details class="section">
      <summary id="i18n-sum-adaptive">âš™ï¸ é©å¿œè¡¨ç¤º</summary>
      <div class="controls section-content">
        <div class="control-group">
          <label>
            <input type="checkbox" id="adaptiveOutlines" />
            é©å¿œçš„æ ç·šåˆ¶å¾¡ã‚’æœ‰åŠ¹åŒ–
          </label>
        </div>
        <div class="control-group">
          <label>æ ç·šãƒ—ãƒªã‚»ãƒƒãƒˆ:</label>
          <select id="outlineWidthPreset">
            <option value="uniform" selected>å‡ä¸€</option>
            <option value="adaptive-density">å¯†åº¦é©å¿œ</option>
            <option value="topn-focus">TopNé‡è¦–</option>
          </select>
        </div>
        <div class="control-group">
          <label>ãƒœãƒƒã‚¯ã‚¹é€æ˜åº¦:</label>
          <select id="boxOpacityMode">
            <option value="off" selected>å›ºå®šï¼ˆå¾“æ¥ï¼‰</option>
            <option value="density">å¯†åº¦ãƒ™ãƒ¼ã‚¹</option>
            <option value="topn">TopNãƒ™ãƒ¼ã‚¹</option>
          </select>
        </div>
        <div class="control-group">
          <label>æ ç·šé€æ˜åº¦:</label>
          <select id="outlineOpacityMode">
            <option value="off" selected>å›ºå®šï¼ˆå¾“æ¥ï¼‰</option>
            <option value="density">å¯†åº¦ãƒ™ãƒ¼ã‚¹</option>
            <option value="topn">TopNãƒ™ãƒ¼ã‚¹</option>
          </select>
        </div>
      </div>
    </details>

    <details class="section">
      <summary id="i18n-sum-highlight">â­ å¼·èª¿è¡¨ç¤º</summary>
      <div class="controls section-content">
        <div class="control-group">
          <label>TopNå¼·èª¿è¡¨ç¤º:</label>
          <input type="number" id="highlightTopN" min="0" max="50" value="0" placeholder="0=ç„¡åŠ¹" />
        </div>
        <div class="control-group" id="highlightStyleGroup" style="opacity: 0.5; pointer-events: none;">
          <label>éTopNã®æ¸›è¡°é‡:</label>
          <input type="range" id="highlightOpacity" min="0.1" max="1" step="0.1" value="0.9" disabled />
          <span id="highlightOpacityValue">0.9</span>
        </div>
      </div>
    </details>

    <details class="section">
      <summary id="i18n-sum-advanced">ğŸ› ï¸ è©³ç´°è¨­å®š</summary>
      <div class="controls section-content">
        <div class="control-group">
          <label>
            <input type="checkbox" id="debugMode" />
            ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ­ã‚°å‡ºåŠ›ï¼‰
          </label>
        </div>
        <div class="control-group">
          <label>
            <input type="checkbox" id="showBounds" />
            å¢ƒç•Œãƒœãƒƒã‚¯ã‚¹è¡¨ç¤º
          </label>
        </div>
        <button id="testHeatbox" style="background-color: orange;">Heatboxãƒ†ã‚¹ãƒˆ</button>
      </div>
    </details>
    
    <div class="section">
      <h3 id="i18n-ops-title">ğŸ® æ“ä½œ</h3>
      <button id="createHeatmap" data-i18n-id="i18n-btn-create">ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ä½œæˆ</button>
      <button id="clearHeatmap" data-i18n-id="i18n-btn-clear">ã‚¯ãƒªã‚¢</button>
      <button id="toggleVisibility" data-i18n-id="i18n-btn-toggle">è¡¨ç¤º/éè¡¨ç¤º</button>
      <button id="exportData" data-i18n-id="i18n-btn-export">ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›</button>
    </div>
  </div>
  
  <div id="info">
    <div class="section">
      <h3 id="i18n-stats-title">ğŸ“Š çµ±è¨ˆæƒ…å ±</h3>
      <div id="statistics">
        <p><span id="i18n-label-dataCount">ãƒ‡ãƒ¼ã‚¿ç‚¹æ•°:</span> <span id="dataCount">0</span></p>
        <p><span id="i18n-label-voxelCount">ãƒœã‚¯ã‚»ãƒ«æ•°:</span> <span id="voxelCount">0</span></p>
        <p><span id="i18n-label-emptyVoxel">ç©ºãƒœã‚¯ã‚»ãƒ«:</span> <span id="emptyVoxelCount">0</span></p>
        <p><span id="i18n-label-max">æœ€å¤§å€¤:</span> <span id="maxValue">-</span></p>
        <p><span id="i18n-label-min">æœ€å°å€¤:</span> <span id="minValue">-</span></p>
        <p><span id="i18n-label-avg">å¹³å‡å€¤:</span> <span id="avgValue">-</span></p>
        <div id="autoSizeInfo" style="font-size: 10px; color: #aaa; margin-top: 5px; display: none;">
          <p><span id="i18n-autosize-adjusted">è‡ªå‹•èª¿æ•´:</span> <span id="autoAdjusted">-</span></p>
          <p><span id="i18n-autosize-size">ã‚µã‚¤ã‚º:</span> <span id="sizeInfo">-</span></p>
        </div>
      </div>
    </div>
    
    <div class="section">
      <h3 id="i18n-env-title">ğŸ” ç’°å¢ƒæƒ…å ±</h3>
      <div id="environmentInfo">
        <p><span id="i18n-label-cesium">Cesium:</span> <span id="cesiumVersion">-</span></p>
        <p><span id="i18n-label-heatbox">Heatbox:</span> <span id="heatboxVersion">-</span></p>
        <p><span id="i18n-label-webgl">WebGL:</span> <span id="webglSupport">-</span></p>
      </div>
    </div>

    <div class="section">
      <h3 id="i18n-or-title">ğŸ§ª Outline Resolver çµ±è¨ˆ</h3>
      <div id="outlineStats" style="font-size: 12px;">
        <p><span id="i18n-label-or-calls">å‘¼ã³å‡ºã—å›æ•°:</span> <span id="or_calls">0</span></p>
        <p><span id="i18n-label-or-avg">å¹³å‡å¤ªã•:</span> <span id="or_avg">-</span> px</p>
        <p><span id="i18n-label-or-minmax">å¤ªã• min/max:</span> <span id="or_min">-</span> / <span id="or_max">-</span> px</p>
        <p><span id="i18n-label-or-dminmax">å¯†åº¦ min/max:</span> <span id="or_dmin">-</span> / <span id="or_dmax">-</span></p>
        <p><span id="i18n-label-or-topn">TopNå¯¾è±¡:</span> <span id="or_topn">0</span></p>
      </div>
    </div>
  </div>
  
  <div id="loading">
    <p>å‡¦ç†ä¸­...</p>
  </div>
  
  <!-- Heatbox ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
  <script src="../cesium-heatbox/dist/cesium-heatbox.umd.min.js?v=0.1.7"></script>
  <script src="app.js"></script>
</body>
</html>
